<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiplex FPCA • mxfda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiplex FPCA">
<meta property="og:description" content="mxfda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mxfda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_mx_fda.html">mxFDA Object</a>
    </li>
    <li>
      <a href="../articles/a02_mx_fpca.html">Multiplex FPCA</a>
    </li>
    <li>
      <a href="../articles/a03_mx_funreg.html">mx Functional Regression</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/julia-wrobel/mxfda/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiplex FPCA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/julia-wrobel/mxfda/blob/HEAD/vignettes/a02_mx_fpca.Rmd" class="external-link"><code>vignettes/a02_mx_fpca.Rmd</code></a></small>
      <div class="hidden name"><code>a02_mx_fpca.Rmd</code></div>

    </div>

    
    
<p>This vignette describes the <a href="https://github.com/julia-wrobel/mxfda" class="external-link">mxfda</a> package for
analyzing single-cell multiplex imaging data using tools from functional
data analysis. Analyses for this package are executed and stored using
an S4 object of class <code>mxFDA</code>. This vignette outlines how to
set up an <code>mxFDA</code> object from spatial single cell imaging
data, how to calculate spatial summary functions, and exploratory data
analysis and visualization of these spatial summary functions. Details
on how to perform downstream analysis and feature extraction using
functional principal components analysis can be found in the separate
vignette <code>mx_fpca</code>. To perform functional regression on
spatial summary functions from multiplex imaging data, see the
<code>mx_funreg</code> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(mxfda)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">mxfda</span></span></span></code></pre></div>
<div class="section level2">
<h2 id="functional-data-notation">Functional data notation<a class="anchor" aria-label="anchor" href="#functional-data-notation"></a>
</h2>
<p>The basic unit of observation is the curve <span class="math inline">\(Y_i(t)\)</span> for subjects <span class="math inline">\(i \in \ldots, I\)</span> in the cross-sectional
setting and <span class="math inline">\(Y_{ij}(t)\)</span> for subject
<span class="math inline">\(i\)</span> at visit <span class="math inline">\(j \in \ldots, J_i\)</span> for the multilevel or
longitudinal structure. Methods for functional data are typically
presented in terms of continuous functions, but in practice data are
observed on a discrete grid that may be sparse or dense at the subject
level and that may be the same across subjects or irregular.</p>
</div>
<div class="section level2">
<h2 id="functional-principal-components-analysis-fpca">Functional principal components analysis (FPCA)<a class="anchor" aria-label="anchor" href="#functional-principal-components-analysis-fpca"></a>
</h2>
<div class="section level3">
<h3 id="background-on-fpca">Background on FPCA<a class="anchor" aria-label="anchor" href="#background-on-fpca"></a>
</h3>
<p>Background on FPCA</p>
<p>FPCA characterizes modes of variability by decomposing functional
observations into population level basis functions and subject-specific
scores . The basis functions have a clear interpretation, analogous to
that of PCA: the first basis function explains the largest direction of
variation, and each subsequent basis function describes less. The FPCA
model is typically written Y_i(t) = (t) + <em>{k=1}^{K}
c</em>{ik}_{k}(t) + _i(t) where <span class="math inline">\(\mu(t)\)</span> is the population mean, <span class="math inline">\(\psi_{k}(t)\)</span> are a set of orthonormal
population-level basis functions, <span class="math inline">\(c_{ik}\)</span> are subject-specific scores with
mean zero and variance <span class="math inline">\(\lambda_k\)</span>,
and <span class="math inline">\(\epsilon_i(t)\)</span> are residual
curves. Estimated basis functions <span class="math inline">\(\widehat{\psi}_1(t), \widehat{\psi}_2(t), \ldots,
\widehat{\psi}_{K}(t)\)</span> and corresponding variances <span class="math inline">\(\widehat{\lambda}_1 \geq \widehat{\lambda}_2 \geq
\ldots \geq \widehat{\lambda}_K\)</span> are obtained from a truncated
Karhunen-Lo`eve decomposition of the sample covariance <span class="math inline">\(\widehat{\Sigma}(s,t) =
\widehat{\mbox{Cov}}(Y_i(s), Y_i(t))\)</span>. In practice, the
covariance <span class="math inline">\(\widehat{\Sigma}(s,t)\)</span> is
often smoothed using a bivariate smoother that omits entries on the main
diagonal to avoid a ``nugget effect” attributable to measurement error,
and scores are estimated in a mixed model framework . The truncation lag
<span class="math inline">\(K\)</span> is often chosen so that the
resulting approximation accounts for at least 95% of observed
variance.</p>
</div>
<div class="section level3">
<h3 id="implementing-fpca">Implementing FPCA<a class="anchor" aria-label="anchor" href="#implementing-fpca"></a>
</h3>
<div class="section level4">
<h4 id="load-and-visualize-data">Load and visualize data<a class="anchor" aria-label="anchor" href="#load-and-visualize-data"></a>
</h4>
<p>Here we load data from the Ovarian cancer dataset that where
univariate nearest-neighbor G-functions for immune cells have already
been extracted. See the vignette <code>mxfda::mx_fda</code> for more
details on extracting spatial summary functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ovarian_FDA"</span><span class="op">)</span></span>
<span><span class="va">ovarian_FDA</span></span>
<span><span class="co">#&gt; mxFDA Object:</span></span>
<span><span class="co">#&gt;  Subjects: 128</span></span>
<span><span class="co">#&gt;  Samples: 128</span></span>
<span><span class="co">#&gt;  Has spatial data</span></span>
<span><span class="co">#&gt;  Univariate Summaries: Gest</span></span>
<span><span class="co">#&gt;  Bivariate Summaries: None</span></span>
<span><span class="co">#&gt; FPCs not yet calculated</span></span>
<span><span class="co">#&gt; MFPCs not yet calculated</span></span>
<span><span class="co">#&gt; FCMs not yet calculated</span></span>
<span><span class="co">#&gt; MFCMs not yet calculated</span></span></code></pre></div>
<p>These functions are visualized below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, y <span class="op">=</span> <span class="st">"fundiff"</span>, what <span class="op">=</span> <span class="st">"uni g"</span>, sampleID <span class="op">=</span> <span class="st">"patient_id"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="a02_mx_fpca_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="run-and-visualize-fpca">Run and visualize FPCA<a class="anchor" aria-label="anchor" href="#run-and-visualize-fpca"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ovarian_FDA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_fpca.html">run_fpca</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, </span>
<span>                        metric <span class="op">=</span> <span class="st">"uni g"</span>, r <span class="op">=</span> <span class="st">"r"</span>, </span>
<span>                        value <span class="op">=</span> <span class="st">"fundiff"</span>,</span>
<span>                        pve <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span></span>
<span><span class="va">ovarian_FDA</span></span>
<span><span class="co">#&gt; mxFDA Object:</span></span>
<span><span class="co">#&gt;  Subjects: 128</span></span>
<span><span class="co">#&gt;  Samples: 128</span></span>
<span><span class="co">#&gt;  Has spatial data</span></span>
<span><span class="co">#&gt;  Univariate Summaries: Gest</span></span>
<span><span class="co">#&gt;  Bivariate Summaries: None</span></span>
<span><span class="co">#&gt; FPCs Calculated:</span></span>
<span><span class="co">#&gt;  Gest: 4 FPCs describe 96.9% variance</span></span>
<span><span class="co">#&gt; MFPCs not yet calculated</span></span>
<span><span class="co">#&gt; FCMs not yet calculated</span></span>
<span><span class="co">#&gt; MFCMs not yet calculated</span></span></code></pre></div>
<p>Explain each of these plots</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, what <span class="op">=</span> <span class="st">'uni g fpca'</span>, pc_choice <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, what <span class="op">=</span> <span class="st">'uni g fpca'</span>, pc_choice <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, what <span class="op">=</span> <span class="st">'uni g fpca'</span>, pc_choice <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>, what <span class="op">=</span> <span class="st">'uni g fpca'</span>, pc_choice <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span><span class="op">)</span></span></code></pre></div>
<p><img src="a02_mx_fpca_files/figure-html/fpc_plots-1.png" width="960"></p>
<p>INTERPRET WHAT YOU LEARNED FROM FPCA- this is an important piece</p>
<p>Shout out to refund.shiny</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">G_fpca</span> <span class="op">=</span> <span class="fu"><a href="../reference/extract_fpca_object.html">extract_fpca_object</a></span><span class="op">(</span><span class="va">ovarian_FDA</span>,</span>
<span>                             what <span class="op">=</span> <span class="st">"uni g fpca"</span>, r <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">G_fpca</span><span class="op">)</span></span>
<span><span class="co">#library(refund.shiny)</span></span>
<span><span class="co">#plot_shiny(G_fpca)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mfpca">MFPCA<a class="anchor" aria-label="anchor" href="#mfpca"></a>
</h2>
<div class="section level3">
<h3 id="mfpca-background">MFPCA Background<a class="anchor" aria-label="anchor" href="#mfpca-background"></a>
</h3>
<p>Background on mfpca</p>
<p>Multilevel functional principal components analysis (MFPCA) extends
the ideas of FPCA to functional data with a multilevel structure.</p>
<p>Multilevel functional data are increasingly common in practice; in
the case of our DTI example, this structure arises from multiple
clinical visits made by each subject. MFPCA models the within-subject
correlation induced by repeated measures as well as the between-subject
correlation modeled by classic FPCA. This leads to a two-level FPC
decomposition, where level 1 concerns subject-specific effects and level
2 concerns visit-specific effects. Population-level basis functions and
subject-specific scores are calculated for both levels . The MFPCA model
is:</p>
<p><span class="math display">\[
    X_{ij}(r) = \mu(r)  +
\sum_{k_1=1}^{K_1}    c_{ik}^{(1)}\psi_{k}^{(1)}(r) +
\sum_{k_2=1}^{K_2}c^{(2)}_{ijk}\psi_{k}^{(2)}(r) + \epsilon_{ij}(r)
\]</span></p>
<p> where <span class="math inline">\(\mu(t)\)</span> is the population
mean, <span class="math inline">\(\eta_j(t)\)</span> is the
visit-specific shift from the overall mean, <span class="math inline">\(\psi_{k}^{(1)}(t)\)</span> and <span class="math inline">\(\psi_{k}^{(2)}(t)\)</span> are the eigenfunctions
for levels 1 and 2, respectively, and <span class="math inline">\(c_{ik}^{(1)}\)</span> and <span class="math inline">\(c^{(2)}_{ijk}\)</span> are the subject-specific
and subject-visit-specific scores. Often, visit-specific means <span class="math inline">\(\eta_j(t)\)</span> are not of interest and can be
omitted from the model. Estimation for MFPCA extends the approach for
FPCA: estimated between- and within-covariances <span class="math inline">\(\widehat{\Sigma}^{(1)}(s,t) =
\widehat{\mbox{Cov}}(Y_{ij}(s), Y_{ij'}(t))\)</span> for <span class="math inline">\(j \neq j'\)</span> and <span class="math inline">\(\widehat{\Sigma}^{(2)}(s,t) =
\widehat{\mbox{Cov}}(Y_{ij}(s), Y_{ij}(t))\)</span> are derived from the
observed data, smoothed, and decomposed to obtain eigenfunctions and
values. Given these objects, scores are estimated in a mixed-model
framework.</p>
</div>
<div class="section level3">
<h3 id="implementing-mfpca">Implementing MFPCA<a class="anchor" aria-label="anchor" href="#implementing-mfpca"></a>
</h3>
<p>Explain that there are multiple curves per subject for MFPCA and
that’s why lung data is better for mfpca</p>
<div class="section level4">
<h4 id="extract-spatial-summary-functions-and-visualize-data">Extract spatial summary functions and visualize data<a class="anchor" aria-label="anchor" href="#extract-spatial-summary-functions-and-visualize-data"></a>
</h4>
<p>Here we extract the univariate K function from the lung data. With
summary functions within the <a href="https://github.com/julia-wrobel/mxfda" class="external-link">mxfda</a> package, they use a
window created by the subset of cells rather than all cells in a core.
This is something to keep in mind.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span></span>
<span><span class="va">clinical</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">image_id</span>, <span class="va">patient_id</span>, <span class="va">patientImage_id</span>, <span class="va">gender</span>, <span class="va">age</span>, <span class="va">survival_days</span>, <span class="va">survival_status</span>, <span class="va">stage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">image_id</span>, <span class="op">-</span><span class="va">gender</span>, <span class="op">-</span><span class="va">age</span>, <span class="op">-</span><span class="va">survival_days</span>, <span class="op">-</span><span class="va">survival_status</span>, <span class="op">-</span><span class="va">stage</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_mxfda.html">make_mxfda</a></span><span class="op">(</span>metadata <span class="op">=</span> <span class="va">clinical</span>,</span>
<span>                         spatial <span class="op">=</span> <span class="va">spatial</span>,</span>
<span>                         subject_key <span class="op">=</span> <span class="st">"patient_id"</span>,</span>
<span>                         sample_key <span class="op">=</span> <span class="st">"patientImage_id"</span></span>
<span>                         <span class="op">)</span></span>
<span></span>
<span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/extract_summary_functions.html">extract_summary_functions</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, </span>
<span>                                        extract_func <span class="op">=</span> <span class="va">extract_univariate</span>,</span>
<span>                                        summary_func <span class="op">=</span> <span class="va">Kest</span>,</span>
<span>                                        r_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                        edge_correction <span class="op">=</span> <span class="st">"iso"</span>,</span>
<span>                                        markvar <span class="op">=</span> <span class="st">"immune"</span>,</span>
<span>                                        mark1 <span class="op">=</span> <span class="st">"immune"</span><span class="op">)</span></span></code></pre></div>
<p>Visualize</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, y <span class="op">=</span> <span class="st">"fundiff"</span>, what <span class="op">=</span> <span class="st">"uni k"</span>, sampleID <span class="op">=</span> <span class="st">"patientImage_id"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 48 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="a02_mx_fpca_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Do some summaries (how many total functions? How many subjects? Range
of number of functions per subject?)</p>
</div>
<div class="section level4">
<h4 id="run-and-visualize-mfpca">Run and visualize MFPCA<a class="anchor" aria-label="anchor" href="#run-and-visualize-mfpca"></a>
</h4>
<p>Right now this takes the same id in both slots and splits it under
the hood. need to change this behavior</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see what happens when you use mfpca.sc as an engine</span></span>
<span><span class="va">mxFDAobject</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mfpca.html">run_mfpca</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, </span>
<span>                       metric <span class="op">=</span> <span class="st">"uni k"</span>, r <span class="op">=</span> <span class="st">"r"</span>, </span>
<span>                       value <span class="op">=</span> <span class="st">"fundiff"</span>,</span>
<span>                       pve <span class="op">=</span> <span class="fl">.99</span>,</span>
<span>                       lightweight <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Explore FPCA object</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot mxFDA object mFPCA</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, what <span class="op">=</span> <span class="st">'uni k mfpca'</span>, level1 <span class="op">=</span> <span class="fl">1</span>, level2 <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="a02_mx_fpca_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#library(refund.shiny)</span></span>
<span><span class="co">#plot_shiny(mfpca)</span></span></code></pre></div>
<p>Calculate variance of level 2 scores. Also, are the</p>
<p>ICC</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fda-tips-principles-things-to-know">FDA Tips / Principles/ Things to know<a class="anchor" aria-label="anchor" href="#fda-tips-principles-things-to-know"></a>
</h2>
<ul>
<li>Sparse vs. even grids- mention these, and what types of analysis you
can do with each</li>
<li>Better to have 20+ measurements per curve- that means using a dense
grid of radii</li>
<li>Number of knots cannot exceed the number of datapoints per
function</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Julia Wrobel, Alex Soupir.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
