<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mx_fda • mxfda</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mx_fda">
<meta property="og:description" content="mxfda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mxfda</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a01_mx_fda.html">mx_fda</a>
    </li>
    <li>
      <a href="../articles/a02_mx_fpca.html">mx_fpca</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>mx_fda</h1>
            
      
      
      <div class="hidden name"><code>a01_mx_fda.Rmd</code></div>

    </div>

    
    
<p>This vignette describes the <code>mxfda</code> package for analyzing
single-cell multiplex imaging data using tools from functional data
analysis. Analyses for this package are executed and stored using an S4
object of class <code>mxFDA</code>. This vignette outlines how to set up
an <code>mxFDA</code> object from spatial single cell imaging data, how
to calculate spatial summary functions, and exploratory data analysis
and visualization of these spatial summary functions. Details on how to
perform downstream analysis and feature extraction using functional
principal components analysis can be found in the separate vignette
<code>mx_fpca</code>. To perform functional regression on spatial
summary functions from multiplex imaging data, see the
<code>mx_funreg</code> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(mxfda)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">mxfda</span></span></span>
<span><span class="co">#&gt; Loading required package: spatstat.explore</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loading required package: spatstat.data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loading required package: spatstat.geom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spatstat.geom 3.2-7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'spatstat.geom'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:patchwork':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     area</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loading required package: spatstat.random</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spatstat.random 3.2-1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nlme'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; spatstat.explore 3.2-5</span></span></code></pre></div>
<div class="section level2">
<h2 id="background-on-functional-data-analysis-for-multiplex-imaging-data">Background on functional data analysis for multiplex imaging
data<a class="anchor" aria-label="anchor" href="#background-on-functional-data-analysis-for-multiplex-imaging-data"></a>
</h2>
<p>What are the goals of mxfda package?</p>
<ul>
<li><p>Make it easier to analyze spatial relationships of cells in
multiplex images</p></li>
<li><p>Use spatial summary functions of point processes to characterize
univariate / bivariate clustering</p></li>
<li><p>Relate spatial summary functions to patient level
outcomes</p></li>
<li><p>Explain how to interpret output from functional data
analyses</p></li>
<li><p>Use completely open source data</p></li>
<li><p>Add references here to relevant papers. Need to add to the
references.bib file then can cite by:</p></li>
</ul>
<p><span class="citation">Wrobel et al. (2019)</span></p>
</div>
<div class="section level2">
<h2 id="vectrapolarisdata">VectraPolarisData<a class="anchor" aria-label="anchor" href="#vectrapolarisdata"></a>
</h2>
<p>All examples in this vignette use data from the <a href="https://bioconductor.org/packages/release/data/experiment/html/VectraPolarisData.html" class="external-link">VectraPolarisData</a>
package on Bioconductor’s ExperimentHub. This package contains data from
two multiplex imaging experiments conducted at the University of
Colorado Anschutz Medical Campus. A shortcourse on single-cell multiplex
imaging using these data is available <a href="http://juliawrobel.com/MI_tutorial/MI_Data.html" class="external-link">here</a>.</p>
<ul>
<li>Describe the two datasets</li>
<li>Say this vignette will focus on the lung data</li>
<li>Data has been preprocessed and stored directly in the package</li>
</ul>
<p>This data contains (number of subjects, images per subject, number of
cells). Load the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load processed lung cancer data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lung_df</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-the-mxfun-object">Setting up the mxfun object<a class="anchor" aria-label="anchor" href="#setting-up-the-mxfun-object"></a>
</h2>
<p>The central object used with the <code>mxfda</code> package is the
<code>mxFDA</code> object. These objects are created with
<code><a href="../reference/make_mxfda.html">make_mxfda()</a></code> and hold everything from the raw spatial data
to fit functional cox models using derived spatial summary functions. To
save space on large samples, the meta data is kept separately from the
spatial data and when needed, is exported and merged back together.
Slots in the <code>mxFDA</code> object are as follows</p>
<ul>
<li>
<code>Metadata</code> - stores sample specific traits that may be
used as covariate when fitting models</li>
<li>
<code>Spatial</code> - a dataframe of cell level information (x, y,
phenotype, etc) that can be used to calculate spatial summary
functions</li>
<li>
<code>subject_key</code> - a character string for the column in the
meta data that denotes the subject samples belong to</li>
<li>
<code>sample_key</code> - a character string for the columns linking
the meta data and spatial data</li>
<li>
<code>univariate_summaries</code> and
<code>bivariate_summaries</code> - list of calculate spatial summary
functions either imported with <code>XX</code> or calculated with
<code><a href="../reference/extract_summary_functions.html">extract_summary_functions()</a></code>
</li>
<li>
<code>functional_pca</code> - list of functional principle
components for the spatial summary functions</li>
<li>
<code>functional_cox</code> - list of functional cox models that
have been fit.</li>
</ul>
<div class="section level3">
<h3 id="make-fdaobject">Make FDAobject<a class="anchor" aria-label="anchor" href="#make-fdaobject"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clinical</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">image_id</span>, <span class="va">patient_id</span>, <span class="va">patientImage_id</span>, <span class="va">gender</span>, <span class="va">age</span>, <span class="va">survival_days</span>, <span class="va">survival_status</span>, <span class="va">stage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">image_id</span>, <span class="op">-</span><span class="va">gender</span>, <span class="op">-</span><span class="va">age</span>, <span class="op">-</span><span class="va">survival_days</span>, <span class="op">-</span><span class="va">survival_status</span>, <span class="op">-</span><span class="va">stage</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_mxfda.html">make_mxfda</a></span><span class="op">(</span>metadata <span class="op">=</span> <span class="va">clinical</span>,</span>
<span>                         spatial <span class="op">=</span> <span class="va">spatial</span>,</span>
<span>                         subject_key <span class="op">=</span> <span class="st">"patient_id"</span>,</span>
<span>                         sample_key <span class="op">=</span> <span class="st">"patientImage_id"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-summary-functions-based-on-point-processes">Spatial summary functions based on point processes<a class="anchor" aria-label="anchor" href="#spatial-summary-functions-based-on-point-processes"></a>
</h2>
<p>Use text from somewhere else here. Talk about K, g, and G and point
to links</p>
<div class="section level3">
<h3 id="univariate-summary-functions">Univariate summary functions<a class="anchor" aria-label="anchor" href="#univariate-summary-functions"></a>
</h3>
<p>Use text from somewhere else here to describe what these are.</p>
<p>Below we calculate univariate Ripley’s K for all immune cells in each
image. Describe that it is using spatstat under the hood. These can be
calculated with our package or spatialTIME. Options for the edge
correction when using Ripley’s K include
<code>"border", "isotropic", "Ripley", "translate"</code>. See
<code>spatstat.core::Kest</code> for more details. Below we calculate
the K function across a range of radii from 0 to 300 and use the
isotropic (“iso”) edge correction. The <code>analysis_vars</code>
argument retains variables that may be used in downstream analysis</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/extract_summary_functions.html">extract_summary_functions</a></span><span class="op">(</span><span class="va">mxFDAobject</span>,</span>
<span>                                        extract_func <span class="op">=</span> <span class="va">extract_univariate</span>,</span>
<span>                                        summary_func <span class="op">=</span> <span class="va">Kest</span>,</span>
<span>                                        r_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                        edge_correction <span class="op">=</span> <span class="st">"iso"</span>,</span>
<span>                                        markvar <span class="op">=</span> <span class="st">"immune"</span>,</span>
<span>                                        mark1 <span class="op">=</span> <span class="st">"immune"</span><span class="op">)</span></span></code></pre></div>
<p>COMMENT ON THESE PLOTS</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, y <span class="op">=</span> <span class="st">"fundiff"</span>, what <span class="op">=</span> <span class="st">"uni k"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 48 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="a01_mx_fda_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>SAY WHAT YOU DO DIFFERENT TO GET L OR G</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">Gcrossdf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rm(Gcrossdf): object 'Gcrossdf' not found</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bivariate-summary-functions">Bivariate summary functions<a class="anchor" aria-label="anchor" href="#bivariate-summary-functions"></a>
</h3>
<p>Use if you want to do bivariate. We will look at relationship between
T-cells and macrophages. There are a few images that have fewer than 5
T-cells or macrophages, which makes estimation less stable for those
images.</p>
<p>Below we calculate the bivariate G function, but replace Lcross or
Kcross to do L or K bivariate functions</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lung_df</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phenotype <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">phenotype_cd8</span> <span class="op">==</span> <span class="st">"CD8+"</span> <span class="op">~</span> <span class="st">"T-cell"</span>,</span>
<span>                               <span class="va">phenotype_cd14</span> <span class="op">==</span> <span class="st">"CD14+"</span> <span class="op">~</span> <span class="st">"macrophage"</span>,</span>
<span>                               <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"other"</span><span class="op">)</span>,</span>
<span>         phenotype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">phenotype</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">patientImage_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">phenotype</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">phenotype</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">phenotype</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   phenotype  `sum(n &lt; 5)`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> macrophage           20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> T-cell               27</span></span></code></pre></div>
<p>Automatically removes images that do not have at least 1 cell of each
type * Is this behavior we actually want?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial</span> <span class="op">=</span> <span class="va">lung_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">image_id</span>, <span class="op">-</span><span class="va">gender</span>, <span class="op">-</span><span class="va">age</span>, <span class="op">-</span><span class="va">survival_days</span>, <span class="op">-</span><span class="va">survival_status</span>, <span class="op">-</span><span class="va">stage</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_mxfda.html">make_mxfda</a></span><span class="op">(</span>metadata <span class="op">=</span> <span class="va">clinical</span>,</span>
<span>                         spatial <span class="op">=</span> <span class="va">spatial</span>,</span>
<span>                         subject_key <span class="op">=</span> <span class="st">"patient_id"</span>,</span>
<span>                         sample_key <span class="op">=</span> <span class="st">"patientImage_id"</span><span class="op">)</span></span></code></pre></div>
<p>Running Gcross on T-cells and macrophages</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mxFDAobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/extract_summary_functions.html">extract_summary_functions</a></span><span class="op">(</span><span class="va">mxFDAobject</span>,</span>
<span>                summary_func <span class="op">=</span> <span class="va">Gcross</span>,</span>
<span>                extract_func <span class="op">=</span> <span class="va">extract_bivariate</span>,</span>
<span>                r_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                edge_correction <span class="op">=</span> <span class="st">"rs"</span>,</span>
<span>                markvar <span class="op">=</span> <span class="st">"phenotype"</span>,</span>
<span>                mark1 <span class="op">=</span> <span class="st">"T-cell"</span>,</span>
<span>                mark2 <span class="op">=</span> <span class="st">"macrophage"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mxFDAobject</span>, y <span class="op">=</span> <span class="st">"fundiff"</span>, what <span class="op">=</span> <span class="st">"bi g"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1365 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="a01_mx_fda_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="exploring-the-s4-object">Exploring the S4 object<a class="anchor" aria-label="anchor" href="#exploring-the-s4-object"></a>
</h2>
<p>Alex to add other details of neat things he has here.</p>
</div>
<div class="section level2">
<h2 id="spatialtime">SpatialTIME<a class="anchor" aria-label="anchor" href="#spatialtime"></a>
</h2>
<p>Add example for converting spatialTIME to long format for use with
mxfda.</p>
</div>
<div class="section level2">
<h2 id="calculating-and-adding-your-own-spatial-summary-function">Calculating and adding your own spatial summary function<a class="anchor" aria-label="anchor" href="#calculating-and-adding-your-own-spatial-summary-function"></a>
</h2>
<p>Add example of how to do this.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wrobel_2019" class="csl-entry">
Wrobel, J., V. Zipunnikov, J. Schrack, and J. Goldsmith. 2019.
<span>“Registration for Exponential Family Functional Data.”</span>
<em>Biometrics</em> 75 (1): 48–57.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Julia Wrobel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
